var SwrveSDK=function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist",n(n.s=7)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=n(5),i=function(){function e(){}return e.infoMsg=function(e){this.parseMsg(r.messageConfig.types.info,e)},e.warnMsg=function(e){this.parseMsg(r.messageConfig.types.warn,e)},e.errorMsg=function(e){this.parseMsg(r.messageConfig.types.error,e)},e.parseMsg=function(e,t){var n="string"!=typeof t?t:void 0,i=r.messageConfig.title+" "+e+": "+(n?"":t),o=null;switch(e){case r.messageConfig.types.info:return o=console.info,s.default.ProdMode?!1:(this.outputMsg(o,i,n),!0);case r.messageConfig.types.warn:return o=console.warn,s.default.ProdMode?!1:(this.outputMsg(o,i,n),!0);case r.messageConfig.types.error:return o=console.error,this.outputMsg(o,i,n),!0}},e.outputMsg=function(e,t,n){n?(console.group(t),Array.isArray(n)?n.forEach(function(t){e(t)}):e(n),console.groupEnd()):e(t)},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.messageConfig={title:"Swrve WebSDK",types:{error:"Error",info:"Info",warn:"Warning"}},t.webWorkerDbName="SwrveWebWorkerDB",t.swrveDefaultDBName="SwrveWebSDK",t.swrveDefaultDBVersion=1,t.swrveServiceWorkerName="SwrveWorker.js",t.swrveVersion=3,t.defaultFlushFrequency=6e4,t.defaultFlushRefreshDelay=5e3},function(e,t,n){"use strict";function r(e){return void 0===e||null===e}Object.defineProperty(t,"__esModule",{value:!0}),t.isNil=r,t.isPresent=function(e){return!r(e)},t.noOp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Function()}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(13),o=n(14),a=n(15),u=n(16),c=n(8),l=n(9),f=n(17),p=n(2),h=n(0),d=n(1),g=n(22),v=n(10),y=n(24),b=n(25),m=n(4),w=n(11),S=function(){function e(e){this.onSwrveLoadedCallback=null,this.flushConfig={flushFrequency:d.defaultFlushFrequency,flushRefreshDelay:d.defaultFlushRefreshDelay},this.eventFactory=new a.default,this.config=new o.default(e),this.localStorageClient=new m.default}return Object.defineProperty(e.prototype,"Config",{get:function(){return this.config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SwrvePushManager",{get:function(){return this.swrvePushManager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"DeviceId",{get:function(){return this.getPersistentDeviceId()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"getUserID",{get:function(){return h.default.infoMsg("UserID Returned:"),h.default.infoMsg(this.profile.UserId),this.profile.UserId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"InstallDate",{get:function(){return this.getPersistentInstallDate()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"InitDate",{get:function(){return this.profile.FirstSession.toString()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"WebPushAPIKey",{get:function(){return this.webPushAPIKey},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsSessionStarted",{get:function(){return null!=this.sessionStartedAt},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LastSession",{get:function(){return this.profile.LastSession.toString()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Profile",{get:function(){return this.profile},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"SessionStartedAt",{get:function(){return this.sessionStartedAt},enumerable:!0,configurable:!0}),e.createInstance=function(t){return e.instance=e.instance||new e(t),e.instance},e.getCurrentInstance=function(){return e.instance},e.prototype.init=function(){return r(this,void 0,void 0,function(){var t;return s(this,function(n){switch(n.label){case 0:h.default.infoMsg("Starting New SwrveSDK instance"),this.initializePersistentData(),n.label=1;case 1:return n.trys.push([1,6,,7]),[4,this.initializeIdentity()];case 2:return n.sent(),this.profile.IsIdentityResolved?(h.default.infoMsg("Profile Resolved: "+this.profile.UserId+" for extUserId: "+this.profile.ExternalUserId),this.hasSessionRestored()||(this.sessionStartedAt=Date.now(),this.sessionStart()),h.default.infoMsg("Generating Session Token"),this.sessionToken=this.generateSessionToken(),h.default.infoMsg("Fetching synchronous campaigns and resources"),[4,this.initCampaignsAndResources()]):[3,4];case 3:return n.sent(),h.default.infoMsg("Initializing event Manager"),this.eventQueueManager=new g.default(this.config,this.flushConfig,this.getUserID,this.sessionToken),this.eventQueueManager.init(),null==this.profile.LastSession&&this.eventInternal(l.eventTypes.namedEvent,{name:l.firstSessionEventName}),h.default.infoMsg("Sending Client Info"),this.sendClientInfo(),this.config.AutoPushSubscribe?(h.default.infoMsg("Initializing PushManager"),this.swrvePushManager=new b.default(this.config,this.WebPushAPIKey),this.swrvePushManager.init()):h.default.infoMsg("SwrvePushManager Will not initialize. Auto subscribe is disabled"),window.onbeforeunload=function(){e.pageCloseHandler()},this.config.AutoPushSubscribe&&h.default.infoMsg("autoPushSubscribe: ON"),p.isPresent(this.onSwrveLoadedCallback)&&this.onSwrveLoadedCallback(null),[3,5];case 4:throw e.shutdown(),new Error("User Profile could not be resolved");case 5:return[3,7];case 6:return t=n.sent(),h.default.errorMsg(t),this.onSwrveLoadedCallback(t.toString()),[3,7];case 7:return[2]}})})},e.shutdown=function(){if(!p.isNil(this.instance)){var e=this.instance.eventQueueManager;p.isNil(e)||e.shutdown(),this.pageCloseHandler(),Object.setPrototypeOf(this.instance,null),this.instance=null}},e.prototype.initCampaignsAndResources=function(){return r(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:return this.campaignManager=new f.default,[4,this.campaignManager.getInfoForSession()];case 1:return(e=t.sent())&&(this.flushConfig={flushFrequency:e.flushFrequency,flushRefreshDelay:e.flushRefreshDelay},this.profile.setQAFlag(e.qa),e.webPushPublicKey&&(this.webPushAPIKey=e.webPushPublicKey),this.campaignManager.init(this.flushConfig)),[2]}})})},e.prototype.registerPush=function(e,t){this.swrvePushManager.registerPush(e,t)},e.prototype.unregisterPush=function(e,t){this.swrvePushManager.unregisterPush(e,t)},e.prototype.sendQueuedEvents=function(){this.eventQueueManager.sendEvents()},e.prototype.getQueuedEvents=function(){return this.localStorageClient.fetchEventsFromQueue(this.getUserID)},e.prototype.namedEvent=function(e){u.default.isValidEventName(e.name)&&this.eventInternal(l.eventTypes.namedEvent,e)},e.prototype.sessionStart=function(){this.sessionStartInternal()},e.prototype.userUpdate=function(e){null!=e?this.userUpdateInternal(e):h.default.errorMsg("There must be at least one key/value pair, this will not be queued")},e.prototype.userUpdateWithDate=function(e){e.name&&e.date?this.userUpdateWithDateInternal(l.eventTypes.userUpdateEvent,e):h.default.errorMsg("Both name and date are mandatory, this will not be added to the queue")},e.prototype.purchaseEvent=function(e){e.cost&&e.item&&e.currency&&e.quantity&&this.purchaseInternal(e.item,e.currency,e.cost,e.quantity)},e.prototype.genericCampaignEvent=function(e){e.actionType&&e.campaignType&&e.campaignId&&e.id&&this.genericCampaignEventInternal({actionType:e.actionType,campaignId:e.campaignId,campaignType:e.campaignType,id:e.id})},e.prototype.pushNotificationEngagedEvent=function(e,t){var n="Swrve.Messages.Push-"+e+".engaged",r=this.eventFactory.constructEvent(this.profile.updateSeqnum(),this.nowInUtcTime(),"event",n),s=[r];if(this.profile.IsQA){var i=this.eventFactory.constructQANotificationEngagedEvent(r,e,t);s.push(i)}this.queueEvents(s)},e.prototype.currencyGiven=function(e){e.currency&&e.amount&&this.currencyGivenInternal({currency:e.currency,amount:e.amount})},Object.defineProperty(e.prototype,"onSwrveLoaded",{set:function(e){"function"==typeof e?this.onSwrveLoadedCallback=e:h.default.errorMsg("invalid function")},enumerable:!0,configurable:!0}),e.prototype.initializeIdentity=function(){return r(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return h.default.infoMsg("Setting up profile"),this.profile=new y.default(this.config.ExternalUserId),this.profile.IsIdentityResolved?[3,2]:[4,this.profile.callIdentifyOnExternalUserId(this.config.ExternalUserId,this)];case 1:e.sent(),this.profile.IsIdentityResolved&&h.default.infoMsg("Identify Resolved: "+this.profile.UserId+" for extUserId: "+this.profile.ExternalUserId),e.label=2;case 2:return[2]}})})},e.prototype.initializePersistentData=function(){this.hasPersistentInstallDate()||(this.sessionStartedAt=Date.now(),this.setPersistentInstallDate()),this.hasPersistentDeviceId()||this.setPersistentDeviceId()},e.prototype.queueEvents=function(e){var t=this;e.forEach(function(e){t.localStorageClient.storeEventOnQueue(t.getUserID,e)}),this.shouldSendEventsImmediately()?this.eventQueueManager.sendEvents():p.noOp()},e.prototype.shouldSendEventsImmediately=function(){return this.profile.IsQA&&!p.isNil(this.eventQueueManager)},e.prototype.eventInternal=function(e,t){var n=this.eventFactory.constructEvent(this.profile.updateSeqnum(),this.nowInUtcTime(),e,t.name,t.payload),r=[n];if(this.profile.IsQA){var s=this.eventFactory.constructQAEvent(n);r.push(s)}this.queueEvents(r)},e.prototype.genericCampaignEventInternal=function(e){var t=this.eventFactory.constructGenericCampaignEvent(this.profile.updateSeqnum(),(new Date).getTime(),e.campaignType,e.campaignId,e.id,e.actionType);this.queueEvents([t])},e.prototype.currencyGivenInternal=function(e){var t=this.eventFactory.constructCurrencyGiven(this.profile.updateSeqnum(),this.nowInUtcTime(),e.currency,e.amount),n=[t];if(this.profile.IsQA){var r=this.eventFactory.constructQACurrencyGiven(t);n.push(r)}this.queueEvents(n)},e.prototype.sessionStartInternal=function(){var e=this.eventFactory.constructSessionStart(this.profile.updateSeqnum(),this.nowInUtcTime()),t=[e];this.profile.IsQA&&t.push(this.eventFactory.constructQASessionStart(e)),this.queueEvents(t)},e.prototype.userUpdateInternal=function(e){var t=this.eventFactory.constructUserUpdate(this.profile.updateSeqnum(),this.nowInUtcTime(),e),n=[t];this.profile.IsQA&&n.push(this.eventFactory.constructQAUserUpdate(t)),this.queueEvents(n)},e.prototype.userUpdateWithDateInternal=function(e,t){var n=this.profile.updateSeqnum(),r=this.eventFactory.constructUserUpdateWithDate(n,this.nowInUtcTime(),t.name,t.date),s=[];s.push(r),this.profile.IsQA&&s.push(this.eventFactory.constructQAUserUpdateWithDate(r)),this.queueEvents(s)},e.prototype.purchaseInternal=function(e,t,n,r){var s=this.profile.updateSeqnum(),i=this.eventFactory.constructPurchaseEvent(s,this.nowInUtcTime(),e,t,n,r),o=[];o.push(i),this.profile.IsQA&&o.push(this.eventFactory.constructQAPurchaseEvent(i)),this.queueEvents(o)},e.prototype.sendClientInfo=function(){var e=this.profile.updateSeqnum(),t=v.default.getClientInfo(),n=this.eventFactory.constructDeviceUpdate(e,this.nowInUtcTime(),t),r=[n];this.profile.IsQA&&r.push(this.eventFactory.constructQADeviceUpdate(n)),this.queueEvents(r)},e.prototype.generateSessionToken=function(){var e=this.sessionStartedAt.toString(),t=new i.Md5;t.appendStr(this.profile.UserId).appendStr(e).appendStr(this.config.ApiKey);var n=t.end();return this.config.AppID+"="+this.profile.UserId+"="+e+"="+n},e.prototype.hasSessionRestored=function(){if(null!=this.profile.LastSession){h.default.infoMsg("LastSession"),h.default.infoMsg(this.profile.LastSession);var e=this.profile.LastSession,t=this.nowInUtcTime(),n=1e3*this.config.NewSessionInterval;return!(!e||t-e>n)&&(h.default.infoMsg("Session is still going, restoring last session"),this.sessionStartedAt=this.profile.LastSession,!0)}return!1},e.prototype.getPersistentInstallDate=function(){return this.localStorageClient.fetchInstallDate()},e.prototype.hasPersistentInstallDate=function(){return p.isPresent(this.getPersistentInstallDate())},e.prototype.setPersistentInstallDate=function(){var e=c.default.dateToUTCDate(new Date(Date.now()));h.default.infoMsg("Setting Install Date:"),h.default.infoMsg(e),this.localStorageClient.storeInstallDate(c.default.dateToSwrveYYYYMMDDFormat(e))},e.prototype.getPersistentDeviceId=function(){return this.localStorageClient.fetchDeviceID()},e.prototype.hasPersistentDeviceId=function(){return p.isPresent(this.getPersistentDeviceId())},e.prototype.setPersistentDeviceId=function(){var e=w.generateUuid();h.default.infoMsg("Setting device id: "+e),this.localStorageClient.storeDeviceID(e.toString())},e.prototype.nowInUtcTime=function(){return c.default.dateToUTCDate(new Date).getTime()},e.pageCloseHandler=function(){null!==this.instance&&this.instance.profile.saveBeforeSessionEnd()},e}();t.default=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(20),s=n(21),i=function(){function e(){this.storageManager=new s.default}return e.prototype.storeInstallDate=function(e){return this.storageManager.writeLocal(r.GlobalNamespaceKeys.InstallDate,e.toString())},e.prototype.fetchInstallDate=function(){var e=this.storageManager.readLocal(r.GlobalNamespaceKeys.InstallDate);return e?e.toString():void 0},e.prototype.storeDeviceID=function(e){return this.storageManager.writeLocal(r.GlobalNamespaceKeys.DeviceID,e)},e.prototype.fetchDeviceID=function(){return this.storageManager.readLocal(r.GlobalNamespaceKeys.DeviceID)},e.prototype.storeUserID=function(e,t){return this.storageManager.writeLocal(this.userIDKey(e),t)},e.prototype.fetchUserID=function(e){return this.storageManager.readLocal(this.userIDKey(e))},e.prototype.storeLastETag=function(e,t){return this.storageManager.writeLocal(this.lastETagKey(e),t)},e.prototype.fetchLastETag=function(e){return this.storageManager.readLocal(this.lastETagKey(e))},e.prototype.storeFirstSession=function(e,t){return this.storageManager.writeLocal(this.firstSessionKey(e),t)},e.prototype.fetchFirstSession=function(e){var t=this.storageManager.readLocal(this.firstSessionKey(e));return t?+t:void 0},e.prototype.storeLastSession=function(e,t){return this.storageManager.writeLocal(this.lastSessionKey(e),t)},e.prototype.fetchLastSession=function(e){var t=this.storageManager.readLocal(this.lastSessionKey(e));return t?+t:void 0},e.prototype.storeSeqnum=function(e,t){return this.storageManager.writeLocal(this.seqnumKey(e),t)},e.prototype.fetchSeqnum=function(e){return+this.storageManager.readLocal(this.seqnumKey(e))},e.prototype.storeLastFlushFrequency=function(e,t){return this.storageManager.writeLocal(this.lastFlushFrequency(e),t)},e.prototype.fetchLastFlushFrequency=function(e){return this.storageManager.readLocal(this.lastFlushFrequency(e))},e.prototype.storeLastFlushRefreshDelay=function(e,t){return this.storageManager.writeLocal(this.lastFlushRefreshDelay(e),t)},e.prototype.fetchLastFlushRefreshDelay=function(e){return this.storageManager.readLocal(this.lastFlushRefreshDelay(e))},e.prototype.storeLastWebPushPublicKey=function(e,t){return this.storageManager.writeLocal(this.lastWebPushPublicKey(e),t)},e.prototype.fetchLastWebPushPublicKey=function(e){return this.storageManager.readLocal(this.lastWebPushPublicKey(e))},e.prototype.storeQAStatus=function(e,t){return this.storageManager.writeLocal(this.qaStatus(e),t)},e.prototype.fetchQAStatus=function(e){return this.storageManager.readLocal(this.qaStatus(e))},e.prototype.storeEventOnQueue=function(e,t){return this.storageManager.writeLocal(this.eventsQueueKey(e),t)},e.prototype.fetchEventKeys=function(e){var t=this;return this.storageManager.localKeys().filter(function(n){return n.startsWith(t.eventsQueueKeyPrefix(e))})},e.prototype.fetchEventsFromQueue=function(e){var t=this,n=[];return this.fetchEventKeys(e).forEach(function(e){n.push(t.fetchEventFromQueue(e))}),n},e.prototype.fetchEventFromQueue=function(e){return this.storageManager.readLocal(e)},e.prototype.deleteEventOnQueue=function(e){this.storageManager.deleteLocal(e)},e.prototype.userIDKey=function(e){return"swrve:"+e+":"+r.ExternalUserNamespaceKeys.UserID},e.prototype.firstSessionKey=function(e){return"swrve:"+e+":"+r.UserNamespaceKeys.FirstSession},e.prototype.lastSessionKey=function(e){return"swrve:"+e+":"+r.UserNamespaceKeys.LastSession},e.prototype.seqnumKey=function(e){return"swrve:"+e+":"+r.UserNamespaceKeys.Seqnum},e.prototype.lastETagKey=function(e){return"swrve:"+e+":"+r.UserNamespaceKeys.LastETag},e.prototype.lastFlushFrequency=function(e){return"swrve:"+e+":"+r.UserNamespaceKeys.LastFlushFrequency},e.prototype.lastFlushRefreshDelay=function(e){return"swrve:"+e+":"+r.UserNamespaceKeys.LastFlushRefreshDelay},e.prototype.lastWebPushPublicKey=function(e){return"swrve:"+e+":"+r.UserNamespaceKeys.LastWebPushPublicKey},e.prototype.qaStatus=function(e){return"swrve:"+e+":"+r.UserNamespaceKeys.QAStatus},e.prototype.eventsQueueKey=function(e){return this.eventsQueueKeyPrefix(e)+":"+this.eventsQueueKeyStamp()},e.prototype.eventsQueueKeyPrefix=function(e){return"swrve:"+e+":"+r.UserNamespaceKeys.Events},e.prototype.eventsQueueKeyStamp=function(){return Date.now()+"-"+window.performance.now()+"-"+Math.random()},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return Object.defineProperty(e,"Mode",{get:function(){return this.mode},set:function(e){this.mode=e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"DevMode",{get:function(){return"dev"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TestMode",{get:function(){return"test"===this.mode},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ProdMode",{get:function(){return"prod"===this.mode},enumerable:!0,configurable:!0}),e.mode="prod",e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,s=n(2),i=n(0);!function(e){e.GET="GET",e.POST="POST"}(r||(r={}));var o=function(){function e(){}return e.get=function(e,t,n){return this.xhrRequest(r.GET,e,null,t,n)},e.post=function(e,t,n,s){return this.xhrRequest(r.POST,e,t,n,s)},e.xhrRequest=function(e,t,n,r,o){var a=this;return new Promise(function(u,c){var l=a.getXmlHttpRequest(e,t),f=null;l.onload=function(){return(f=a.getXmlHTTPResponse(e,l)).statusCode>=400?(i.default.warnMsg("Restclient received status code: "+f.statusCode),s.isNil(o)||o(f),c(f)):(s.isNil(r)||r(f),u(f))},l.onerror=function(){return i.default.warnMsg("RESTClient encountered an error"),s.isNil(o)||o(f),c(new Error(l.statusText))},n?l.send(JSON.stringify(n)):l.send()})},e.getXmlHTTPResponse=function(e,t){return{etag:e===r.GET&&"{}"!==t.responseText?t.getResponseHeader("Etag"):null,jsonBody:t.responseText,statusCode:t.status}},e.getXmlHttpRequest=function(e,t){var n=new XMLHttpRequest;return n.open(e,t,!0),n.setRequestHeader("Content-type","application/json"),n},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),s=n(3),i=n(5),o=null,a=function(){function e(e){var t=r.default.validateInitParams(e);if(t)throw r.default.outputErrors(t),new TypeError("Parameters are not correct");i.default.Mode=e.mode||"prod",o=s.default.createInstance(e)}return e.createInstance=function(t){return e.instance?e.instance:(e.instance=new e(t),e.instance.init(),e.instance)},e.prototype.init=function(){return e.checkInstance().init()},e.checkInstance=function(){if(null==o)throw Error("Please call SwrveSDK.createInstance() first");return o},e.namedEvent=function(t){e.checkInstance().namedEvent(t)},e.userUpdate=function(t){e.checkInstance().userUpdate(t)},e.userUpdateWithDate=function(t){e.checkInstance().userUpdateWithDate(t)},e.purchaseEvent=function(t){e.checkInstance().purchaseEvent(t)},e.currencyGiven=function(t){e.checkInstance().currencyGiven(t)},e.getQueuedEvents=function(){return e.checkInstance().getQueuedEvents()},e.getConfig=function(){return e.checkInstance().Config},e.getPushManager=function(){return e.checkInstance().SwrvePushManager},e.registerPush=function(t,n){return e.checkInstance().registerPush(t,n)},e.unregisterPush=function(t,n){return e.checkInstance().unregisterPush(t,n)},e.getUserId=function(){return e.checkInstance().getUserID},e.getExternalUserId=function(){return e.checkInstance().Config.ExternalUserId},e.shutdown=function(){null!=o&&s.default.shutdown(),o=null,e.instance=null},Object.defineProperty(e,"onSwrveLoaded",{set:function(t){e.checkInstance().onSwrveLoaded=t},enumerable:!0,configurable:!0}),e.instance=null,e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.dateToSwrveISOString=function(e){return e.toISOString().split(".")[0]+"Z"},e.dateToSwrveYYYYMMDDFormat=function(e){return e.toISOString().split("T")[0].replace(/-/g,"")},e.dateToUTCDate=function(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds()))},e}();t.default=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eventTypes={currencyGiven:"currency_given",deviceUpdateEvent:"device_update",genericCampaignEvent:"generic_campaign_event",namedEvent:"event",purchaseEvent:"purchase",qaLogEvent:"qa_log_event",sessionStartEvent:"session_start",userUpdateEvent:"user"},t.firstSessionEventName="Swrve.first_session",t.sessionStartEventName="Swrve.session_start"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(3),s=n(2),i=n(0),o=n(19),a=function(){function e(){}return e.getClientInfo=function(){var e,t=this.getOS(),n=this.getBrowserInfo();return(e={})[o.SWRVE_DEVICE_ID]=this.getDeviceId(),e[o.SWRVE_OS]=t.name,e[o.SWRVE_OS_VERSION]=t.version,e[o.SWRVE_SDK_VERSION]=o.sdkVersion,e[o.SWRVE_LANGUAGE]=this.getBrowserLanguage(),e[o.SWRVE_COUNTRY_CODE]=this.getCountryCode(),e[o.SWRVE_DEVICE_REGION]=this.getRegion(),e[o.SWRVE_TIMEZONE_NAME]=this.getTimezoneName(),e[o.SWRVE_UTC_OFFSET_SECONDS]=this.getUTCOffsetSeconds(new Date),e[o.SWRVE_APP_STORE]=o.appStore,e[o.SWRVE_INSTALL_DATE]=this.getInstallDate(),e[o.SWRVE_BROWSER_NAME]=n.name,e[o.SWRVE_BROWSER_VERSION]=n.version,e},e.getOS=function(){var e,t={},n=navigator.userAgent.match(/\((.*?)\)/);n&&n.length>=2&&(t.version=n[1]);for(var r=0,s=o.osRegex;r<s.length;r++)if((e=s[r]).regex.test(navigator.userAgent)){t.name=e.name;break}return t},e.getDeviceName=function(){return this.getOS().name+" "+this.getBrowserInfo().name+" "+this.getBrowserInfo().version},e.getScreenResolution=function(){return{height:window.screen.availHeight.toString()||"Unknown",width:window.screen.availWidth.toString()||"Unknown"}},e.getBrowserLanguage=function(){return navigator[o.SWRVE_NAV_LANGUAGE]||"Unknown"},e.getTimezoneName=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone||"Unknown"},e.getUTCOffsetSeconds=function(e){var t=-60*e.getTimezoneOffset();return-0===t?0:t},e.getCountryCode=function(){return"Unknown"},e.getRegion=function(){return"Unknown"},e.getInstallDate=function(){var e=r.default.getCurrentInstance();return e?e.InstallDate.toString():null},e.getDeviceId=function(){var e=r.default.getCurrentInstance();return e?e.DeviceId.toString():null},e.getBrowserInfo=function(){var e,t=new RegExp("version/(([0-9])+(.([0-9])+)+)"),n=new RegExp("rv:(([0-9])+(.([0-9])+)+)"),r={name:"Unknown",version:"N/A"},o=navigator.userAgent.toLowerCase(),a=this.checkBrowser();for(var u in a)if(!s.isNil(a[u]))return r.name=u,"safari"===u?(e=o.match(t),r.version=e?e[1]:"N/A",r):(e=o.match(new RegExp("("+("msIE"===u?"msIE|edge":u)+")( |/)(([0-9])+(.([0-9])+)+)")))?(r.version=e[3]||"N/A",r):(e=o.match(n),r.version=e?e[1]:"N/A",r);return i.default.errorMsg("Cannot identify browser"),r},e.checkBrowser=function(){var e=navigator.userAgent.toLowerCase();return{chrome:o.browsersRegex.webkit.test(e)&&o.browsersRegex.chrome.test(e)&&!o.browsersRegex.edge.test(e),firefox:o.browsersRegex.mozilla.test(e)&&o.browsersRegex.firefox.test(e),msIE:o.browsersRegex.msIE.test(e)||o.browsersRegex.trident.test(e)||o.browsersRegex.edge.test(e),opera:o.browsersRegex.mozilla.test(e)&&o.browsersRegex.appleWebkit.test(e)&&o.browsersRegex.chrome.test(e)&&o.browsersRegex.safari.test(e)&&o.browsersRegex.opera.test(e),safari:o.browsersRegex.safari.test(e)&&o.browsersRegex.appleWebkit.test(e)&&!o.browsersRegex.chrome.test(e)}},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uuidRegex=/^\s*([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})\s*$/i,t.parseUuid=function(e){var n=t.uuidRegex.exec(e);if(null==n)throw new Error("Invalid UUID");var s=(n[1]+n[2]+n[3]+n[4]+n[5]).split(/(..)/g).filter(function(e){return 2===e.length}).map(function(e){return parseInt(e,16)});return new r(s)},t.generateUuid=function(){var e=crypto.getRandomValues(new Uint8Array(16));return e[6]=15&e[6]|64,e[8]=63&e[8]|128,new r(Array.from(e))};var r=function(){function e(e){if(16!==e.length)throw new Error("Invalid UUID: Incorrect byte count");this.bytes=e.map(function(e){return 255&e})}return e.prototype.toString=function(){return this.bytes.map(function(e){return e.toString(16)}).map(function(e){return("0"+e).substr(-2)}).join("").replace(/^(.{8})(.{4})(.{4})(.{4})(.{12})$/,"$1-$2-$3-$4-$5")},e}();t.Uuid=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=n(5),i=n(0),o=/[(https):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi,a=function(){function e(){}return e.validateExternalUserId=function(e){var t=[];return null!=e&&"string"!=typeof e&&t.push("externalUserId should be a string"),t},e.validateAppId=function(e){var t=[];e||t.push("appId doesn't exist");return e&&"number"!=typeof e&&t.push("appId should be a number"),t},e.validateApiKey=function(e){var t=[];e||t.push("apiKey doesn't exist");return e&&"string"!=typeof e&&t.push("apiKey should be a string"),e&&"string"==typeof e&&!e.startsWith("web_sdk-")&&t.push("apiKey should be a valid web_sdk api key"),t},e.validateContentUrl=function(e){var t=[];e&&"string"!=typeof e&&t.push("contentURL should be a string");var n=new RegExp(o);return e&&!n.test(e)&&t.push("contentURL isn't valid URL"),t},e.validateApiUrl=function(e){var t=[];e&&"string"!=typeof e&&t.push("apiURL should be a string");var n=new RegExp(o);return e&&!n.test(e)&&t.push("apiURL isn't a valid URL"),t},e.validateVersion=function(e){var t=[];e&&"string"!=typeof e&&t.push("version should be a string");return e&&!/(([0-9])+(\.([0-9])+)+)/.test(e)&&t.push("version isn't valid"),t},e.validateSessionTimeout=function(e){var t=[];return e&&"number"!=typeof e&&t.push("sessionTimeout should be a number"),e&&e<0&&t.push("sessionTimeout should be positive integer or 0"),t},e.validateInitParams=function(e){var t={};if(e&&"[object Object]"===Object.prototype.toString.call(e)?t.devErrors=this.validateExternalUserId(e.externalUserId).concat(this.validateAppId(e.appId),this.validateApiKey(e.apiKey),this.validateContentUrl(e.contentURL),this.validateApiUrl(e.apiURL),this.validateVersion(e.appVersion),this.validateSessionTimeout(e.httpTimeoutSeconds)):t.devErrors=["Init params should follow the scheme:\n        {\n          appId: number - *required\n          apiKey: string - *required\n          apiURL: string\n          contentURL: string\n          sessionTimeout: number\n          externalUserId: string - *required\n          version: string\n          devMode: boolean\n        }"],t.devErrors.length)return t.mainError="Initial configuration parameters are incorrect",t},e.outputErrors=function(e){s.default.ProdMode?i.default.errorMsg(r.messageConfig.title+" "+r.messageConfig.types.error+": "+e.mainError):(i.default.errorMsg(r.messageConfig.title+" "+r.messageConfig.types.error+": "+e.mainError),e.devErrors.forEach(function(e){i.default.errorMsg(" "+e)}))},e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this._state=new Int32Array(4),this._buffer=new ArrayBuffer(68),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}return e.hashStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendStr(e).end(t)},e.hashAsciiStr=function(e,t){return void 0===t&&(t=!1),this.onePassHasher.start().appendAsciiStr(e).end(t)},e._hex=function(t){var n,r,s,i,o=e.hexChars,a=e.hexOut;for(i=0;i<4;i+=1)for(r=8*i,n=t[i],s=0;s<8;s+=2)a[r+1+s]=o.charAt(15&n),n>>>=4,a[r+0+s]=o.charAt(15&n),n>>>=4;return a.join("")},e._md5cycle=function(e,t){var n=e[0],r=e[1],s=e[2],i=e[3];r=((r+=((s=((s+=((i=((i+=((n=((n+=(r&s|~r&i)+t[0]-680876936|0)<<7|n>>>25)+r|0)&r|~n&s)+t[1]-389564586|0)<<12|i>>>20)+n|0)&n|~i&r)+t[2]+606105819|0)<<17|s>>>15)+i|0)&i|~s&n)+t[3]-1044525330|0)<<22|r>>>10)+s|0,r=((r+=((s=((s+=((i=((i+=((n=((n+=(r&s|~r&i)+t[4]-176418897|0)<<7|n>>>25)+r|0)&r|~n&s)+t[5]+1200080426|0)<<12|i>>>20)+n|0)&n|~i&r)+t[6]-1473231341|0)<<17|s>>>15)+i|0)&i|~s&n)+t[7]-45705983|0)<<22|r>>>10)+s|0,r=((r+=((s=((s+=((i=((i+=((n=((n+=(r&s|~r&i)+t[8]+1770035416|0)<<7|n>>>25)+r|0)&r|~n&s)+t[9]-1958414417|0)<<12|i>>>20)+n|0)&n|~i&r)+t[10]-42063|0)<<17|s>>>15)+i|0)&i|~s&n)+t[11]-1990404162|0)<<22|r>>>10)+s|0,r=((r+=((s=((s+=((i=((i+=((n=((n+=(r&s|~r&i)+t[12]+1804603682|0)<<7|n>>>25)+r|0)&r|~n&s)+t[13]-40341101|0)<<12|i>>>20)+n|0)&n|~i&r)+t[14]-1502002290|0)<<17|s>>>15)+i|0)&i|~s&n)+t[15]+1236535329|0)<<22|r>>>10)+s|0,r=((r+=((s=((s+=((i=((i+=((n=((n+=(r&i|s&~i)+t[1]-165796510|0)<<5|n>>>27)+r|0)&s|r&~s)+t[6]-1069501632|0)<<9|i>>>23)+n|0)&r|n&~r)+t[11]+643717713|0)<<14|s>>>18)+i|0)&n|i&~n)+t[0]-373897302|0)<<20|r>>>12)+s|0,r=((r+=((s=((s+=((i=((i+=((n=((n+=(r&i|s&~i)+t[5]-701558691|0)<<5|n>>>27)+r|0)&s|r&~s)+t[10]+38016083|0)<<9|i>>>23)+n|0)&r|n&~r)+t[15]-660478335|0)<<14|s>>>18)+i|0)&n|i&~n)+t[4]-405537848|0)<<20|r>>>12)+s|0,r=((r+=((s=((s+=((i=((i+=((n=((n+=(r&i|s&~i)+t[9]+568446438|0)<<5|n>>>27)+r|0)&s|r&~s)+t[14]-1019803690|0)<<9|i>>>23)+n|0)&r|n&~r)+t[3]-187363961|0)<<14|s>>>18)+i|0)&n|i&~n)+t[8]+1163531501|0)<<20|r>>>12)+s|0,r=((r+=((s=((s+=((i=((i+=((n=((n+=(r&i|s&~i)+t[13]-1444681467|0)<<5|n>>>27)+r|0)&s|r&~s)+t[2]-51403784|0)<<9|i>>>23)+n|0)&r|n&~r)+t[7]+1735328473|0)<<14|s>>>18)+i|0)&n|i&~n)+t[12]-1926607734|0)<<20|r>>>12)+s|0,r=((r+=((s=((s+=((i=((i+=((n=((n+=(r^s^i)+t[5]-378558|0)<<4|n>>>28)+r|0)^r^s)+t[8]-2022574463|0)<<11|i>>>21)+n|0)^n^r)+t[11]+1839030562|0)<<16|s>>>16)+i|0)^i^n)+t[14]-35309556|0)<<23|r>>>9)+s|0,r=((r+=((s=((s+=((i=((i+=((n=((n+=(r^s^i)+t[1]-1530992060|0)<<4|n>>>28)+r|0)^r^s)+t[4]+1272893353|0)<<11|i>>>21)+n|0)^n^r)+t[7]-155497632|0)<<16|s>>>16)+i|0)^i^n)+t[10]-1094730640|0)<<23|r>>>9)+s|0,r=((r+=((s=((s+=((i=((i+=((n=((n+=(r^s^i)+t[13]+681279174|0)<<4|n>>>28)+r|0)^r^s)+t[0]-358537222|0)<<11|i>>>21)+n|0)^n^r)+t[3]-722521979|0)<<16|s>>>16)+i|0)^i^n)+t[6]+76029189|0)<<23|r>>>9)+s|0,r=((r+=((s=((s+=((i=((i+=((n=((n+=(r^s^i)+t[9]-640364487|0)<<4|n>>>28)+r|0)^r^s)+t[12]-421815835|0)<<11|i>>>21)+n|0)^n^r)+t[15]+530742520|0)<<16|s>>>16)+i|0)^i^n)+t[2]-995338651|0)<<23|r>>>9)+s|0,r=((r+=((i=((i+=(r^((n=((n+=(s^(r|~i))+t[0]-198630844|0)<<6|n>>>26)+r|0)|~s))+t[7]+1126891415|0)<<10|i>>>22)+n|0)^((s=((s+=(n^(i|~r))+t[14]-1416354905|0)<<15|s>>>17)+i|0)|~n))+t[5]-57434055|0)<<21|r>>>11)+s|0,r=((r+=((i=((i+=(r^((n=((n+=(s^(r|~i))+t[12]+1700485571|0)<<6|n>>>26)+r|0)|~s))+t[3]-1894986606|0)<<10|i>>>22)+n|0)^((s=((s+=(n^(i|~r))+t[10]-1051523|0)<<15|s>>>17)+i|0)|~n))+t[1]-2054922799|0)<<21|r>>>11)+s|0,r=((r+=((i=((i+=(r^((n=((n+=(s^(r|~i))+t[8]+1873313359|0)<<6|n>>>26)+r|0)|~s))+t[15]-30611744|0)<<10|i>>>22)+n|0)^((s=((s+=(n^(i|~r))+t[6]-1560198380|0)<<15|s>>>17)+i|0)|~n))+t[13]+1309151649|0)<<21|r>>>11)+s|0,r=((r+=((i=((i+=(r^((n=((n+=(s^(r|~i))+t[4]-145523070|0)<<6|n>>>26)+r|0)|~s))+t[11]-1120210379|0)<<10|i>>>22)+n|0)^((s=((s+=(n^(i|~r))+t[2]+718787259|0)<<15|s>>>17)+i|0)|~n))+t[9]-343485551|0)<<21|r>>>11)+s|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=s+e[2]|0,e[3]=i+e[3]|0},e.prototype.start=function(){return this._dataLength=0,this._bufferLength=0,this._state.set(e.stateIdentity),this},e.prototype.appendStr=function(t){var n,r,s=this._buffer8,i=this._buffer32,o=this._bufferLength;for(r=0;r<t.length;r+=1){if((n=t.charCodeAt(r))<128)s[o++]=n;else if(n<2048)s[o++]=192+(n>>>6),s[o++]=63&n|128;else if(n<55296||n>56319)s[o++]=224+(n>>>12),s[o++]=n>>>6&63|128,s[o++]=63&n|128;else{if((n=1024*(n-55296)+(t.charCodeAt(++r)-56320)+65536)>1114111)throw new Error("Unicode standard supports code points up to U+10FFFF");s[o++]=240+(n>>>18),s[o++]=n>>>12&63|128,s[o++]=n>>>6&63|128,s[o++]=63&n|128}o>=64&&(this._dataLength+=64,e._md5cycle(this._state,i),o-=64,i[0]=i[16])}return this._bufferLength=o,this},e.prototype.appendAsciiStr=function(t){for(var n,r=this._buffer8,s=this._buffer32,i=this._bufferLength,o=0;;){for(n=Math.min(t.length-o,64-i);n--;)r[i++]=t.charCodeAt(o++);if(i<64)break;this._dataLength+=64,e._md5cycle(this._state,s),i=0}return this._bufferLength=i,this},e.prototype.appendByteArray=function(t){for(var n,r=this._buffer8,s=this._buffer32,i=this._bufferLength,o=0;;){for(n=Math.min(t.length-o,64-i);n--;)r[i++]=t[o++];if(i<64)break;this._dataLength+=64,e._md5cycle(this._state,s),i=0}return this._bufferLength=i,this},e.prototype.getState=function(){var e=this._state;return{buffer:String.fromCharCode.apply(null,this._buffer8),buflen:this._bufferLength,length:this._dataLength,state:[e[0],e[1],e[2],e[3]]}},e.prototype.setState=function(e){var t,n=e.buffer,r=e.state,s=this._state;for(this._dataLength=e.length,this._bufferLength=e.buflen,s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],t=0;t<n.length;t+=1)this._buffer8[t]=n.charCodeAt(t)},e.prototype.end=function(t){void 0===t&&(t=!1);var n,r=this._bufferLength,s=this._buffer8,i=this._buffer32,o=1+(r>>2);if(this._dataLength+=r,s[r]=128,s[r+1]=s[r+2]=s[r+3]=0,i.set(e.buffer32Identity.subarray(o),o),r>55&&(e._md5cycle(this._state,i),i.set(e.buffer32Identity)),(n=8*this._dataLength)<=4294967295)i[14]=n;else{var a=n.toString(16).match(/(.*?)(.{0,8})$/);if(null===a)return;var u=parseInt(a[2],16),c=parseInt(a[1],16)||0;i[14]=u,i[15]=c}return e._md5cycle(this._state,i),t?this._state:e._hex(this._state)},e.stateIdentity=new Int32Array([1732584193,-271733879,-1732584194,271733878]),e.buffer32Identity=new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),e.hexChars="0123456789abcdef",e.hexOut=[],e.onePassHasher=new e,e}();t.Md5=r,"5d41402abc4b2a76b9719d911017c592"!==r.hashStr("hello")&&console.error("Md5 self test failed.")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=function(){function e(e){this.appID=null,this.apiKey=null,this.apiURL=null,this.contentURL=null,this.identifyURL=null,this.language=null,this.newSessionInterval=null,this.httpTimeoutSeconds=null,this.serviceWorker=null,this.pushEnabled=!1,this.autoPushSubscribe=!1,this.userVisibleOnly=!0,this.externalUserId=e.externalUserId,this.appID=e.appId,this.apiKey=e.apiKey,this.stack=e.stack||"us",this.language=e.language||"English",this.newSessionInterval=e.newSessionInterval||30,this.resolveApiUrl(e),this.resolveContentUrl(e),this.resolveIdentifyUrl(e),this.appVersion=e.appVersion||"1.0",this.httpTimeoutSeconds=e.httpTimeoutSeconds||10,this.autoPushSubscribe=e.autoPushSubscribe||!1,this.serviceWorker=e.serviceWorker||r.swrveServiceWorkerName}return Object.defineProperty(e.prototype,"ExternalUserId",{get:function(){return this.externalUserId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AppVersion",{get:function(){return this.appVersion},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AppID",{get:function(){return this.appID},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ApiKey",{get:function(){return this.apiKey},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ApiURL",{get:function(){return this.apiURL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ContentURL",{get:function(){return this.contentURL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IdentifyURL",{get:function(){return this.identifyURL},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ServiceWorker",{get:function(){return this.serviceWorker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"AutoPushSubscribe",{get:function(){return this.autoPushSubscribe},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"HttpTimeoutSeconds",{get:function(){return this.httpTimeoutSeconds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Language",{get:function(){return this.language},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"NewSessionInterval",{get:function(){return this.newSessionInterval},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UserVisibleOnly",{get:function(){return this.userVisibleOnly},enumerable:!0,configurable:!0}),e.prototype.resolveApiUrl=function(e){var t="eu"===e.stack?"eu-api":"api";this.apiURL=e.apiURL||"https://"+e.appId+"."+t+".swrve.com"},e.prototype.resolveContentUrl=function(e){this.contentURL=e.contentURL||"https://"+e.appId+".content.swrve.com"},e.prototype.resolveIdentifyUrl=function(e){var t="eu"===this.stack?"eu-identity":"identity";this.identifyURL=e.identifyURL||"https://"+e.appId+"."+t+".swrve.com/identify"},e}();t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),s=n(9),i=function(){function e(){}return e.prototype.constructEvent=function(e,t,n,r,s){var i={seqnum:e,time:t,type:n};return null!=r&&(i.name=r),i.payload=null!=s?s:{},i},e.prototype.constructQAEvent=function(e){var t={client_time:e.time,parameters:{name:e.name},seqnum:e.seqnum,type:e.type};return e.name&&e.payload&&(t.parameters={name:e.name,payload:e.payload}),e.name&&!e.payload&&(t.parameters={name:e.name}),e.name||e.payload||(t.parameters={}),this.constructQAWrappedEvent(t)},e.prototype.constructSessionStart=function(e,t,n,r){return this.constructEvent(e,t,s.eventTypes.sessionStartEvent,n,r)},e.prototype.constructQASessionStart=function(e){return this.constructQAEvent(e)},e.prototype.constructUserUpdate=function(e,t,n){return{attributes:n,seqnum:e,time:t,type:s.eventTypes.userUpdateEvent}},e.prototype.constructQAUserUpdate=function(e){var t={client_time:e.time,parameters:{attributes:e.attributes},seqnum:e.seqnum,type:e.type};return this.constructQAWrappedEvent(t)},e.prototype.constructUserUpdateWithDate=function(e,t,n,s){var i=r.default.dateToUTCDate(s),o={name:n,date:r.default.dateToSwrveISOString(i)};return this.constructUserUpdate(e,t,o)},e.prototype.constructQAUserUpdateWithDate=function(e){return this.constructQAUserUpdate(e)},e.prototype.constructGenericCampaignEvent=function(e,t,n,r,i,o){return{actionType:o,campaignId:r,campaignType:n,id:i,seqnum:e,time:t,type:s.eventTypes.genericCampaignEvent}},e.prototype.constructDeviceUpdate=function(e,t,n){return{attributes:n,seqnum:e,time:t,type:s.eventTypes.deviceUpdateEvent}},e.prototype.constructQADeviceUpdate=function(e){var t={client_time:e.time,parameters:{attributes:e.attributes},seqnum:e.seqnum,type:e.type};return this.constructQAWrappedEvent(t)},e.prototype.constructPurchaseEvent=function(e,t,n,r,i,o){return{cost:i,currency:r,item:n,quantity:o,seqnum:e,time:t,type:s.eventTypes.purchaseEvent}},e.prototype.constructQAPurchaseEvent=function(e){var t={client_time:e.time,parameters:{cost:e.cost,currency:e.currency,item:e.item,quantity:e.quantity},seqnum:e.seqnum,type:e.type};return this.constructQAWrappedEvent(t)},e.prototype.constructCurrencyGiven=function(e,t,n,r){return{given_amount:r,given_currency:n,seqnum:e,time:t,type:s.eventTypes.currencyGiven}},e.prototype.constructQACurrencyGiven=function(e){var t={client_time:e.time,parameters:{given_amount:e.given_amount,given_currency:e.given_currency},seqnum:e.seqnum,type:e.type};return this.constructQAWrappedEvent(t)},e.prototype.constructQANotificationEngagedEvent=function(e,t,n){var r={client_time:e.time,parameters:{campaign_id:t,payload:{deeplink:n}},seqnum:e.seqnum,type:e.type};return{log_details:r,log_source:"sdk",log_type:"push-engaged",seqnum:r.seqnum,time:r.client_time,type:"qa_log_event"}},e.prototype.constructQAWrappedEvent=function(e){return{log_details:e,log_source:"sdk",log_type:"event",seqnum:e.seqnum,time:e.client_time,type:"qa_log_event"}},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),s=function(){function e(){}return e.isValidEventName=function(e){for(var t=0,n=["Swrve.","swrve."];t<n.length;t++){var s=n[t];if(null==e||e.startsWith(s))return r.default.errorMsg("Event names cannot begin with: "+s+" :: This event will not be sent. Eventname: "+e),!1}return!0},e}();t.default=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(18),o=n(1),a=n(10),u=n(6),c=n(4),l=n(3),f=n(2),p=n(0),h=function(){function e(){}return e.prototype.init=function(e){this.flushConfig=e,this.processInBackground()},e.prototype.getInfoForSession=function(){return r(this,void 0,void 0,function(){var e,t,n,r,i,a;return s(this,function(s){switch(s.label){case 0:e=l.default.getCurrentInstance(),t=new c.default,n=f.isPresent(t.fetchLastFlushRefreshDelay(e.Profile.UserId)),e.Profile.Etag&&n&&l.default.getCurrentInstance().Profile.setEtag(null),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.getResourcesAndCampaigns()];case 2:return r=s.sent(),p.default.infoMsg(r.jsonBody),void 0!==r.jsonBody&&"{}"!==r.jsonBody&&200===r.statusCode&&(i=JSON.parse(r.jsonBody),console.log("SHANEDEBUG"),console.log(i),t.storeLastFlushFrequency(e.Profile.UserId,i.flush_frequency),t.storeLastFlushRefreshDelay(e.Profile.UserId,i.flush_refresh_delay),t.storeQAStatus(e.Profile.UserId,"qa"in i),t.storeLastWebPushPublicKey(e.Profile.UserId,i.web_push_public_key),r.etag&&l.default.getCurrentInstance().Profile.setEtag(r.etag)),[2,{flushFrequency:t.fetchLastFlushFrequency(e.Profile.UserId)||o.defaultFlushFrequency,flushRefreshDelay:t.fetchLastFlushRefreshDelay(e.Profile.UserId)||o.defaultFlushRefreshDelay,qa:t.fetchQAStatus(e.Profile.UserId)||!1,webPushPublicKey:t.fetchLastWebPushPublicKey(e.Profile.UserId)||null}];case 3:return a=s.sent(),p.default.errorMsg(a),[2,{flushFrequency:o.defaultFlushFrequency,flushRefreshDelay:o.defaultFlushRefreshDelay,qa:!1,webPushPublicKey:null}];case 4:return[2]}})})},e.prototype.processInBackground=function(){if(this.isProcessing)return null;this.setAsStarted();try{this.getResourcesAndCampaigns()}catch(e){p.default.errorMsg("SwrveSDK - An error has occured processing events"),p.default.errorMsg(e)}this.setAsStopped(),this.timeoutProcess=setTimeout(this.processInBackground.bind(this),this.flushConfig.flushFrequency)},e.prototype.shutdown=function(){clearTimeout(this.timeoutProcess),this.timeoutProcess=void 0},e.prototype.setAsStarted=function(){this.isProcessing=!0,this.lastProcessingStart=Date.now()},e.prototype.setAsStopped=function(){this.isProcessing=!1,this.lastProcessingStop=Date.now()},e.prototype.resourceAndCampaignRequestUrl=function(e){var t={api_key:e.Config.ApiKey,app_store:i.resourcesCampaignSpecialParams.app_store,app_version:e.Config.AppVersion||o.swrveVersion.toString(),device_height:a.default.getScreenResolution().height,device_name:a.default.getDeviceName(),device_width:a.default.getScreenResolution().width,joined:e.Profile.FirstSession.toString(),language:a.default.getBrowserLanguage(),orientation:i.resourcesCampaignSpecialParams.orientation,os:a.default.getOS().name,os_version:a.default.getOS().version,user:e.Profile.UserId,version:i.resourcesCampaignSpecialParams.version};e.Profile.Etag&&(t.etag=e.Profile.Etag);var n=Object.keys(t).map(function(e){return e+"="+t[e]}).join("&"),r=this.replaceWhitespaces(n,"+");return e.Config.ContentURL+"/"+i.resourcesCampaignURL+"?"+r},e.prototype.getResourcesAndCampaigns=function(){return r(this,void 0,void 0,function(){var e;return s(this,function(t){return e=this.resourceAndCampaignRequestUrl(l.default.getCurrentInstance()),[2,u.default.get(e)]})})},e.prototype.replaceWhitespaces=function(e,t){return e.replace(/\s/g,t)},e}();t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resourcesCampaignURL="api/1/user_resources_and_campaigns",t.resourcesCampaignSpecialParams={app_store:"web",orientation:"both",version:"7"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sdkVersion="Web 1.1.0",t.appStore="web",t.SWRVE_APP_STORE="swrve.app_store",t.SWRVE_COUNTRY_CODE="swrve.country_code",t.SWRVE_DEVICE_ID="swrve.device_id",t.SWRVE_DEVICE_NAME="swrve.device_name",t.SWRVE_DEVICE_REGION="swrve.device_region",t.SWRVE_DEVICE_WIDTH="swrve.device_width",t.SWRVE_DEVICE_HEIGHT="swrve.device_height",t.SWRVE_DEVICE_DPI="swrve.device_dpi",t.SWRVE_INSTALL_DATE="swrve.install_date",t.SWRVE_LANGUAGE="swrve.language",t.SWRVE_OS="swrve.os",t.SWRVE_OS_VERSION="swrve.os_version",t.SWRVE_SDK_VERSION="swrve.sdk_version",t.SWRVE_TIMEZONE_NAME="swrve.timezone_name",t.SWRVE_USER_ID="swrve.user_id",t.SWRVE_UTC_OFFSET_SECONDS="swrve.utc_offset_seconds",t.SWRVE_BROWSER_NAME="swrve.browser_name",t.SWRVE_BROWSER_VERSION="swrve.browser_version",t.SWRVE_NAV_LANGUAGE="language",t.browserList=["chrome","opera","safari","firefox","msIE","Unknown"],t.browsersRegex={appleWebkit:/applewebkit/,chrome:/chrome/,edge:/edge/,firefox:/firefox/,mozilla:/mozilla/,msIE:/msie/,opera:/opr/,safari:/safari/,trident:/trident/,webkit:/webkit/},t.osList=["Windows 10","Windows 8.1","Windows 8","Windows 7","Windows Vista","Windows Server 2003","Windows XP","Windows 2000","Windows ME","Windows 98","Windows 95","Windows NT 4.0","Windows CE","Windows 3.11","Android","Open BSD","Sun OS","Linux","iOS","Mac OS X","Mac OS","QNX","UNIX","BeOS","OS/2","Search Bot","Unknown"],t.osRegex=[{name:"Windows 10",regex:/(Windows 10.0|Windows NT 10.0)/},{name:"Windows 8.1",regex:/(Windows 8.1|Windows NT 6.3)/},{name:"Windows 8",regex:/(Windows 8|Windows NT 6.2)/},{name:"Windows 7",regex:/(Windows 7|Windows NT 6.1)/},{name:"Windows Vista",regex:/Windows NT 6.0/},{name:"Windows Server 2003",regex:/Windows NT 5.2/},{name:"Windows XP",regex:/(Windows NT 5.1|Windows XP)/},{name:"Windows 2000",regex:/(Windows NT 5.0|Windows 2000)/},{name:"Windows ME",regex:/(Win 9x 4.90|Windows ME)/},{name:"Windows 98",regex:/(Windows 98|Win98)/},{name:"Windows 95",regex:/(Windows 95|Win95|Windows_95)/},{name:"Windows NT 4.0",regex:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{name:"Windows CE",regex:/Windows CE/},{name:"Windows 3.11",regex:/Win16/},{name:"Android",regex:/Android/},{name:"Open BSD",regex:/OpenBSD/},{name:"Sun OS",regex:/SunOS/},{name:"Linux",regex:/(Linux|X11)/},{name:"iOS",regex:/(iPhone|iPad|iPod)/},{name:"Mac OS X",regex:/Mac OS X/},{name:"Mac OS",regex:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{name:"QNX",regex:/QNX/},{name:"UNIX",regex:/UNIX/},{name:"BeOS",regex:/BeOS/},{name:"OS/2",regex:/OS\/2/},{name:"Search Bot",regex:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.DeviceID="device_id",e.InstallDate="install_date"}(t.GlobalNamespaceKeys||(t.GlobalNamespaceKeys={})),function(e){e.UserID="user_id"}(t.ExternalUserNamespaceKeys||(t.ExternalUserNamespaceKeys={})),function(e){e.Events="events",e.FirstSession="first_session",e.LastSession="last_session",e.LastETag="last_etag",e.Seqnum="seqnum",e.LastFlushFrequency="last_flush_frequency",e.LastFlushRefreshDelay="last_flush_refresh_delay",e.LastWebPushPublicKey="last_web_push_public_key",e.QAStatus="qa_status"}(t.UserNamespaceKeys||(t.UserNamespaceKeys={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),s=function(){function e(){this.dbName=r.swrveDefaultDBName,this.dbVersion=r.swrveDefaultDBVersion,this.local=localStorage}return e.clear=function(){localStorage.clear()},e.prototype.writeLocal=function(e,t){var n=this.serialize(t);this.local.setItem(e,n)},e.prototype.readLocal=function(e){var t=this.local.getItem(e);return null===t?null:this.deserialize(t)},e.prototype.deleteLocal=function(e){return this.local.removeItem(e)},e.prototype.localKeys=function(){for(var e=[],t=0;t<this.local.length;t+=1)e.push(this.local.key(t));return e},e.prototype.serialize=function(e){return"string"==typeof e?e:JSON.stringify(e)},e.prototype.deserialize=function(e){var t=null;try{t=JSON.parse(e)}catch(n){t=e}return t},e.initailized=!1,e}();t.default=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(23),o=n(4),a=n(3),u=n(0),c=function(){function e(e,t,n,r){var s=a.default.getCurrentInstance(),u=s?s.InstallDate:void 0,c=s?s.DeviceId:void 0;this.userID=n,this.installDate=u,this.deviceID=c,this.sessionToken=r,this.swrveConfig=e,this.flushConfig=t,this.localStorageClient=new o.default,this.eventAPIClient=new i.default(e.ApiURL,this.userID,this.deviceID)}return e.prototype.init=function(){return r(this,void 0,void 0,function(){return s(this,function(e){switch(e.label){case 0:return[4,this.processInBackground()];case 1:return e.sent(),[2]}})})},e.prototype.shutdown=function(){clearTimeout(this.timeoutProcess);try{this.sendEvents()}catch(e){u.default.errorMsg("SwrveSDK - could not clear events before shutdown"),u.default.errorMsg(e)}this.timeoutProcess=void 0},e.prototype.deleteEvents=function(e){var t=this;u.default.infoMsg("Deleting Events from Queue"),e.forEach(function(e){t.localStorageClient.deleteEventOnQueue(e)})},e.prototype.sendEvents=function(){return r(this,void 0,void 0,function(){var e,t,n,r,i,o,a=this;return s(this,function(s){switch(s.label){case 0:if(e=this.localStorageClient.fetchEventsFromQueue(this.userID),t=this.localStorageClient.fetchEventKeys(this.userID),n=function(e){a.deleteEvents(t)},r=function(e){e.statusCode<500?a.deleteEvents(t):u.default.errorMsg("Swrve API responded with status code: "+e.statusCode+" and body: "+e.jsonBody+". Leaving events in queue")},i={apiURL:this.swrveConfig.ApiURL,appVersion:this.swrveConfig.AppVersion,deviceID:this.deviceID,sessionToken:this.sessionToken,userId:this.userID},!(e.length>0))return[3,4];s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.eventAPIClient.sendEventBatch(i,e,n,r)];case 2:return s.sent(),[3,4];case 3:return o=s.sent(),u.default.warnMsg("There was an error sending the event batch"),u.default.warnMsg(o),[3,4];case 4:return[2]}})})},e.prototype.processInBackground=function(){return r(this,void 0,void 0,function(){var e;return s(this,function(t){switch(t.label){case 0:if(this.isProcessing)return u.default.warnMsg("EventQueueManager is already processing"),[2,null];this.setAsStarted(),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.sendEvents()];case 2:return t.sent(),[3,4];case 3:return e=t.sent(),u.default.errorMsg("SwrveSDK - An error has occured processing events"),u.default.errorMsg(e),[3,4];case 4:return this.setAsStopped(),this.timeoutProcess=setTimeout(this.processInBackground.bind(this),this.flushConfig.flushFrequency),[2]}})})},e.prototype.setAsStarted=function(){this.isProcessing=!0,this.lastProcessingStart=Date.now()},e.prototype.setAsStopped=function(){this.isProcessing=!1,this.lastProcessingStop=Date.now()},e}();t.default=c},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=n(6),a=function(){function e(e,t,n){this.apiVersion=1,this.eventBatchUriPath="/batch",this.baseUrl=new URL(this.apiVersion.toString(),e).toString(),this.deviceId=n,this.userId=t}return e.prototype.sendEventBatch=function(e,t,n,i){return r(this,void 0,void 0,function(){var r;return s(this,function(s){switch(s.label){case 0:return(r=this.eventBatchRequestParams(e)).body.data=t,[4,o.default.post(r.url,r.body,n,i)];case 1:return[2,s.sent()]}})})},e.prototype.eventBatchRequestParams=function(e){return{url:""+this.baseUrl+this.eventBatchUriPath,body:this.requestBodyPrototype(e)}},e.prototype.requestBodyPrototype=function(e){var t={};return t.session_token=e.sessionToken,t.app_version=e.appVersion,t.user=this.userId,t.unique_device_id=this.deviceId,t.version=i.swrveVersion,t},e}();t.default=a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),o=n(4),a=n(2),u=n(0),c=n(11),l=function(){function e(e){var t=null,n=this.getSwrveProfileFromExternalUserId(e);null!=n&&void 0!==n?(t=n,this.externalUserId=t.extUserId,this.userId=t.userId,this.firstSession=t.firstSession,this.lastSession=t.lastSession,this.seqnum=t.seqnum,this.isQA=t.qa,t.etag&&(this.etag=t.etag),this.isIdentityResolved=!0):(u.default.infoMsg("No Profile Found In Storage. Calling identify API"),this.isIdentityResolved=!1)}return Object.defineProperty(e.prototype,"ExternalUserId",{get:function(){return this.externalUserId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"UserId",{get:function(){return this.userId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"FirstSession",{get:function(){return this.firstSession},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"LastSession",{get:function(){return this.lastSession},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Seqnum",{get:function(){return this.seqnum},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Etag",{get:function(){return this.etag},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsQA",{get:function(){return this.isQA},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"IsIdentityResolved",{get:function(){return this.isIdentityResolved},enumerable:!0,configurable:!0}),e.prototype.callIdentifyOnExternalUserId=function(e,t){return r(this,void 0,void 0,function(){var n,r,o,l,f,p;return s(this,function(s){switch(s.label){case 0:n=c.generateUuid().toString(),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,i.default.post(t.Config.IdentifyURL,{api_key:t.Config.ApiKey,swrve_id:n,external_user_id:e,unique_device_id:t.DeviceId})];case 2:return void 0!==(r=s.sent()).jsonBody&&200===r.statusCode?(o=JSON.parse(r.jsonBody),l={extUserId:e,firstSession:Date.now(),qa:!1,seqnum:0,userId:o.swrve_id},this.externalUserId=l.extUserId,this.userId=l.userId,this.firstSession=l.firstSession,this.lastSession=l.lastSession,this.seqnum=l.seqnum,this.isQA=l.qa,this.isIdentityResolved=!0,this.saveSwrveProfileToStorage(l)):(f=a.isNil(r.jsonBody)?"with no message.":" message: "+r.jsonBody,u.default.errorMsg("Identify failed: "+r.statusCode+" :: "+f)),[3,4];case 3:return p=s.sent(),u.default.errorMsg(p),[3,4];case 4:return[2]}})})},e.prototype.setEtag=function(e){this.etag=e},e.prototype.setQAFlag=function(e){this.isQA=e},e.prototype.getSwrveProfileFromExternalUserId=function(t){try{var n=e.getSwrveProfileFromStorage(t);return!a.isNil(n)&&this.isValidResultProfile(n)?(u.default.infoMsg("Received from Storage: "+n.userId+" | "+n.extUserId+" | "+n.seqnum+" | "+n.firstSession+" | "+n.lastSession+" | "+n.etag),n):null}catch(e){return u.default.errorMsg(e),null}},e.prototype.updateSeqnum=function(){return this.seqnum=this.seqnum+1,this.seqnum},e.prototype.saveBeforeSessionEnd=function(){this.lastSession=Date.now();var e={extUserId:this.externalUserId,firstSession:this.firstSession,lastSession:this.lastSession,qa:this.isQA,seqnum:this.seqnum,userId:this.userId};this.etag&&(e.etag=this.etag),this.saveSwrveProfileToStorage(e)},e.getSwrveProfileFromStorage=function(e){var t=new o.default,n=t.fetchUserID(e);return{etag:t.fetchLastETag(n),extUserId:e,firstSession:t.fetchFirstSession(n),lastSession:t.fetchLastSession(n),qa:t.fetchQAStatus(n),seqnum:t.fetchSeqnum(n),userId:n}},e.prototype.saveSwrveProfileToStorage=function(e){var t=new o.default;t.storeUserID(e.extUserId,e.userId),t.storeSeqnum(e.userId,e.seqnum),t.storeFirstSession(e.userId,e.firstSession),t.storeQAStatus(e.userId,e.qa),e.lastSession&&t.storeLastSession(e.userId,e.lastSession),e.etag&&t.storeLastETag(e.userId,e.etag)},e.prototype.isValidResultProfile=function(e){return!(a.isNil(e.userId)||a.isNil(e.extUserId)||a.isNil(e.firstSession)||a.isNil(e.seqnum))},e}();t.default=l},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){e.done?s(e.value):new n(function(t){t(e.value)}).then(o,a)}u((r=r.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),o=n(26),a=n(2),u=n(0);t.serviceWorkerEventTypes={swrvePushNotificationClicked:"swrve.push_clicked",swrvePushNotificationClosed:"swrve.push_closed",swrvePushReceived:"swrve.push_receieved"};var c=function(){function e(e,t,n,r,s){this.config=e,this.isInitialised=!1,this.webPushApiKey=t,this.callBackPushRecieved=n,this.callBackPushClicked=r,this.callBackPushClosed=s}return Object.defineProperty(e.prototype,"IsInitialised",{get:function(){return this.isInitialised},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"WebPushApiKey",{get:function(){return this.webPushApiKey},enumerable:!0,configurable:!0}),e.prototype.init=function(){this.IsInitialised?u.default.infoMsg("SwrvePushManager :: Already Initialised"):this.isPushSupported()?(this.isInitialised=!0,this.config.AutoPushSubscribe&&this.registerPush()):u.default.infoMsg("SwrvePushManager :: Push is not supported")},e.prototype.registerPush=function(e,t){var n=this;this.check();var r=a.isNil(e)?a.noOp:e,s=a.isNil(t)?a.noOp:t,i=this.config.ServiceWorker;navigator.serviceWorker.register(i).then(function(e){u.default.infoMsg("Registering service worker: "+i),u.default.infoMsg(e),e.pushManager.getSubscription().then(function(t){if(!a.isNil(t))return u.default.infoMsg("Already subscribed to push"),n.sendPushRegistrationProperties(t),void r();u.default.infoMsg("Attempting to subscribe to push");var i={applicationServerKey:o.base64UrlToUint8Array(n.webPushApiKey),userVisibleOnly:n.config.UserVisibleOnly};e.pushManager.subscribe(i).then(function(e){n.sendPushRegistrationProperties(e),u.default.infoMsg("Subscribed Successfully"),r()}).catch(function(e){u.default.errorMsg("Subcription to push failed"),u.default.errorMsg(e),s(e)})}).catch(function(e){u.default.errorMsg("Cannot get Push Subscription Information"),u.default.errorMsg(e),s(e)})}),this.registerPushListeners()},e.prototype.unregisterPush=function(e,t){this.check();var n=a.isNil(e)?a.noOp:e,r=a.isNil(t)?a.noOp:t,s=function(e){u.default.errorMsg(e),r(e)};navigator.serviceWorker.ready.then(function(e){e.pushManager.getSubscription().then(function(e){a.isNil(e)?u.default.warnMsg("Could not unregister push. No subscription found"):e.unsubscribe().then(function(){navigator.serviceWorker.getRegistrations().then(function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];u.default.infoMsg("Unregistering from Service Worker"),u.default.infoMsg(r),r.unregister()}}),n()}).catch(function(e){u.default.errorMsg("Error unsubscribing from push"),s(e)})}).catch(function(e){u.default.errorMsg("Error fetching existing subscription"),s(e)})})},e.prototype.isPushSupported=function(){return"serviceWorker"in navigator&&"PushManager"in window},e.prototype.onPushReceived=function(e){return u.default.infoMsg("Notification Received"),a.isNil(this.callBackPushRecieved)?null:this.callBackPushRecieved(e)},e.prototype.onPushClicked=function(e){return u.default.infoMsg("Notification Clicked"),u.default.infoMsg(e),a.isPresent(e.data)&&a.isPresent(e.data.body.id)&&i.default.checkInstance().pushNotificationEngagedEvent(e.data.body.id,e.data.body.deeplink),a.isNil(this.callBackPushClicked)?null:this.callBackPushClicked(e)},e.prototype.onPushClosed=function(e){return u.default.infoMsg("Notification Closed"),a.isNil(this.callBackPushClosed)?null:this.callBackPushClosed(e)},e.prototype.registerPushListeners=function(){var e=this;navigator.serviceWorker.removeEventListener("message",this.pushHandler),navigator.serviceWorker.addEventListener("message",function(t){e.pushHandler(t)}.bind(this),!1)},e.prototype.pushHandler=function(e){u.default.infoMsg("PushManager receieved message event"),u.default.infoMsg(e);var n=e.data;if(a.isNil(n))u.default.errorMsg("Could not parse message from service worker");else switch(n.type){case t.serviceWorkerEventTypes.swrvePushReceived:this.onPushReceived(e);break;case t.serviceWorkerEventTypes.swrvePushNotificationClicked:this.onPushClicked(e);break;case t.serviceWorkerEventTypes.swrvePushNotificationClosed:this.onPushClosed(e)}},e.prototype.check=function(){if(!this.IsInitialised)throw new Error("SwrvePushManager Not Initialised!")},e.prototype.sendPushRegistrationProperties=function(e){var t=e.toJSON(),n=t.keys.auth,r=t.keys.p256dh,s=t.endpoint;this.webPushToken=s+"|"+r+"|"+n,u.default.infoMsg("sending push registration properties : "+this.webPushToken),u.default.infoMsg(t),i.default.userUpdate({"swrve.web_push_token":this.webPushToken}),this.sendBrowserPermissions(e)},e.prototype.sendBrowserPermissions=function(e){return r(this,void 0,void 0,function(){var e=this;return s(this,function(t){switch(t.label){case 0:return this.browserHasPermissionsAccess()?[4,navigator.permissions.query({name:"notifications"}).then(function(t){u.default.infoMsg("notifications permission status is  "+t.state),e.sendPermissionsUpdate(t.state),t.onchange=function(t){u.default.infoMsg("notifications permission status has changed to "+t.target.state),e.sendPermissionsUpdate(t.target.state)}})]:[3,2];case 1:return t.sent(),[3,3];case 2:u.default.warnMsg("notifications permission status is unknown"),this.sendPermissionsUpdate("unknown"),t.label=3;case 3:return[2]}})})},e.prototype.sendPermissionsUpdate=function(e){i.default.userUpdate({"swrve.permission.web.push_notifications":e})},e.prototype.browserHasPermissionsAccess=function(){return void 0!==navigator.permissions},e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.base64UrlToUint8Array=function(e){for(var t=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/"),n=window.atob(t),r=new Uint8Array(n.length),s=0;s<n.length;s+=1)r[s]=n.charCodeAt(s);return r}}]);
//# sourceMappingURL=SwrveSDK.js.map